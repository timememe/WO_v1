// ============================================
// DUELOGUE v2 - NARRATIVE GENERATOR
// ============================================
// Генерация тезисов и высказываний для создания живых дебатов

class NarrativeGenerator {
    constructor() {
        // Библиотека тезисов для каждой карты
        this.cardTexts = {
            // ========== КАРТЫ ИГРОКА ==========

            // Логика
            'p_logic_1': [
                'Факты говорят сами за себя: статистика подтверждает мою позицию.',
                'Посмотрите на данные - они неоспоримы.',
                'Цифры не лгут. Вот конкретные показатели.'
            ],
            'p_logic_2': [
                'По последним исследованиям, 87% экспертов согласны с этим.',
                'Статистика за последние 10 лет показывает четкую тенденцию.',
                'Данные международных институтов подтверждают: это работает.'
            ],
            'p_logic_3': [
                'Если принять вашу логику, то следует, что вы противоречите себе.',
                'Логическая цепочка проста: из А следует Б, из Б следует В.',
                'Применив дедукцию, мы приходим к очевидному выводу.'
            ],
            'p_logic_4': [
                'Вот конкретный пример, который опровергает ваш тезис.',
                'История знает случаи, когда такой подход приводил к обратному.',
                'Позвольте привести контрпример из реальной практики.'
            ],

            // Эмоции
            'p_emotion_1': [
                'Я сам прошел через это. Я знаю, о чем говорю.',
                'Позвольте рассказать мою историю - она покажет, почему я прав.',
                'Мой личный опыт доказывает обратное тому, что вы утверждаете.'
            ],
            'p_emotion_2': [
                'Это вопрос базовых человеческих ценностей!',
                'Мы говорим о фундаментальных принципах морали.',
                'Есть вещи, которые просто правильны - и это одна из них.'
            ],
            'p_emotion_3': [
                'Представьте мир, где мы игнорируем эту проблему. Каким он станет?',
                'История помнит тех, кто имел смелость отстаивать правду.',
                'Мы стоим на пороге выбора, который определит наше будущее.'
            ],
            'p_emotion_4': [
                'Знаете, есть старая поговорка: "Не рой яму другому".',
                'Это как в том анекдоте про философа и лошадь...',
                'Ирония в том, что вы сами только что доказали мою правоту.'
            ],

            // Нейтральные
            'p_neutral_1': [
                'Это интересный вопрос, но давайте посмотрим с другой стороны.',
                'Не думаю, что мы сейчас говорим об одном и том же.',
                'Ваша постановка вопроса некорректна изначально.'
            ],
            'p_neutral_2': [
                'А что вы скажете о том, что ваш подход уже провалился в прошлом?',
                'Интересно, что вы не упомянули ключевой аспект проблемы.',
                'Вопрос не в этом. Вопрос в том, готовы ли вы к последствиям?'
            ],

            // ========== КАРТЫ ПРОТИВНИКА ==========

            // Логика
            'e_logic_1': [
                'Где доказательства? Голословные утверждения ничего не значат.',
                'Покажите мне хоть одно исследование, подтверждающее ваши слова.',
                'Это звучит красиво, но факты где?'
            ],
            'e_logic_2': [
                'Вы сами себе противоречите! Минуту назад утверждали обратное.',
                'Ваша логическая цепочка разваливается на первом же шаге.',
                'Это классическое логическое противоречие.'
            ],
            'e_logic_3': [
                'Исследования Оксфордского университета говорят об обратном.',
                'Научный консенсус давно опроверг эти идеи.',
                'Все ведущие эксперты согласны: это не работает.'
            ],
            'e_logic_4': [
                'Это классический софизм! Подмена тезиса налицо.',
                'Вы используете ошибку "после не значит вследствие".',
                'Это логическая ошибка из учебника по критическому мышлению.'
            ],

            // Эмоции
            'e_emotion_1': [
                'Серьезно? Вы действительно в это верите?',
                'Это настолько абсурдно, что даже не знаю, с чего начать.',
                'Ваша наивность просто поразительна.'
            ],
            'e_emotion_2': [
                'Как мило. А теперь давайте вернемся к реальности.',
                'Ваша уверенность впечатляет. Жаль, что она ничем не обоснована.',
                'Вы сами-то слышите, что говорите?'
            ],
            'e_emotion_3': [
                'Это просто чушь! Даже ребенок понял бы, что это не работает.',
                'Какая абсурдная идея! Вы хоть думаете, прежде чем говорить?',
                'Это настолько глупо, что я даже не знаю, как реагировать.'
            ],
            'e_emotion_4': [
                'Мне все равно на ваши чувства. Есть факты, есть логика.',
                'Эмоции - это не аргумент. Давайте о деле.',
                'Ваши личные переживания никого не интересуют.'
            ],

            // Нейтральные
            'e_neutral_1': [
                '...',
                '*молчаливо смотрит*',
                '*игнорирует ваш аргумент*'
            ],
            'e_neutral_2': [
                'А как насчет того факта, что вы вообще не эксперт в этой области?',
                'Забавно, что вы не упомянули главное противоречие.',
                'Давайте лучше поговорим о том, почему вы избегаете прямого ответа.'
            ]
        };

        // Реакции на специальные ситуации
        this.situationalTexts = {
            vulnerability: {
                player: [
                    '— и это попадает прямо в слабое место вашего аргумента!',
                    '— вы сами открыли мне эту возможность.',
                    '— именно этого я и ждал.'
                ],
                enemy: [
                    '— вы сами дали мне козырь.',
                    '— спасибо за такую удобную мишень.',
                    '— это была ошибка с вашей стороны.'
                ]
            },
            momentum: {
                player: [
                    'И я продолжаю эту мысль...',
                    'Более того...',
                    'И это еще не все...'
                ],
                enemy: [
                    'И я не остановлюсь...',
                    'Продолжу в том же духе...',
                    'И еще один факт...'
                ]
            },
            zone_winning: {
                player: [
                    'Вы начинаете понимать мою правоту?',
                    'Чувствуете, как почва уходит из-под ног?',
                    'Ваша позиция слабеет.'
                ],
                enemy: [
                    'Вы уверены в своих словах?',
                    'Похоже, вам нечего ответить.',
                    'Ваши аргументы заканчиваются.'
                ]
            },
            zone_losing: {
                player: [
                    'Но постойте...',
                    'Однако...',
                    'Это не совсем так...'
                ],
                enemy: [
                    'Сдаетесь?',
                    'Нечего сказать?',
                    'Вот так-то.'
                ]
            },
            zone_critical: {
                player: [
                    'Признавайте поражение!',
                    'Q.E.D. - что и требовалось доказать.',
                    'Дело закрыто.'
                ],
                enemy: [
                    'Все. Вы проиграли.',
                    'Хватит позориться.',
                    'Это конец дискуссии.'
                ]
            }
        };
    }

    // ============================================
    // ГЕНЕРАЦИЯ ТЕЗИСА
    // ============================================

    generateDialogue(turnData) {
        const { card, isPlayer, vulnerabilityTriggered, momentumActive, zone } = turnData;

        // Базовый тезис из карты
        let dialogue = this.getCardText(card.id);

        // Добавляем ситуационный контекст
        if (vulnerabilityTriggered) {
            dialogue += ' ' + this.getRandomText(
                this.situationalTexts.vulnerability[isPlayer ? 'player' : 'enemy']
            );
        } else if (momentumActive && turnData.momentumBonus > 0) {
            const momentumPrefix = this.getRandomText(
                this.situationalTexts.momentum[isPlayer ? 'player' : 'enemy']
            );
            dialogue = momentumPrefix + ' ' + dialogue;
        }

        // Добавляем реакцию на зону
        if (zone === 'critical-win' && isPlayer) {
            dialogue += ' ' + this.getRandomText(this.situationalTexts.zone_critical.player);
        } else if (zone === 'critical-lose' && !isPlayer) {
            dialogue += ' ' + this.getRandomText(this.situationalTexts.zone_critical.enemy);
        } else if (zone === 'winning' && isPlayer && Math.random() > 0.7) {
            dialogue += ' ' + this.getRandomText(this.situationalTexts.zone_winning.player);
        } else if (zone === 'losing' && isPlayer && Math.random() > 0.7) {
            dialogue = this.getRandomText(this.situationalTexts.zone_losing.player) + ' ' + dialogue;
        }

        return dialogue;
    }

    // ============================================
    // ВСПОМОГАТЕЛЬНЫЕ МЕТОДЫ
    // ============================================

    getCardText(cardId) {
        const texts = this.cardTexts[cardId];
        if (!texts || texts.length === 0) {
            console.warn(`Нет текстов для карты: ${cardId}`);
            return 'Аргумент неопровержим.';
        }
        return this.getRandomText(texts);
    }

    getRandomText(textArray) {
        return textArray[Math.floor(Math.random() * textArray.length)];
    }

    // Генерация речевого пузыря (короткая версия для визуала)
    generateSpeechBubble(card) {
        // Короткие фразы для речевого пузыря
        const bubbleTexts = {
            'Логика': ['Факты!', 'Статистика!', 'Логика!', 'Доказательства!'],
            'Эмоции': ['Это правда!', 'Я знаю!', 'Поверьте мне!', 'Очевидно!'],
            'Тактика': ['Хм...', 'Интересно...', 'Подождите...', 'А что насчет...']
        };

        const category = card.category;
        const texts = bubbleTexts[category] || ['...'];
        return this.getRandomText(texts);
    }
}

console.log('✅ Модуль narrative_v2.js загружен');
